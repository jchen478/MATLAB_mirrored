clc;
clear;
close all;

%% given
Gij = [    11.25212479     -3.85926986      4.59779739]';
Gji = [   -13.47001266      3.88722062     -5.50868607]';
Ami = [     3.63186574     -0.34426710      0.30304095;
    -0.34426710      2.78200030     -0.10735201;
    0.30304095     -0.10735201      2.75454044];
Anj = [     3.65287185     -0.29684022      0.32547021;
    -0.29684022      2.74879456     -0.09731057;
    0.32547021     -0.09731057      2.76674008];
uxflmi = [    16.92319870      0.00000000      0.00000000]';
uxflnj = [    27.02968216      0.00000000      0.00000000]';
Dmi = [    -0.01865050     -0.04752866      0.00581574]';
Dnj = [    -0.01608117     -0.04800576      0.00527175]';
fcmi = [     2.67572451     -2.35547638    -11.25670719]';
fcnj = [    -2.67572451      2.35547638     11.25670719]';
tcmi = [    54.27267075    138.96429443    -16.17777252]';
tcnj = [    56.73287964    166.36770630    -21.32716751]';
fmi = [    42.72783279    -10.64583778     12.38407612]';
fnj = [   -42.72783279     10.64583778    -12.38407612]';
tmi = [     1.15391541     57.10675049     45.10994720]';
tnj = [    10.50494003     68.56056213     22.69294739]';
tbmi = [    -0.00000000     -0.00000000      0.00000000]';
tbnj = [    -0.00000000     -0.00000000      0.00000000]';
pmi = [    -0.90434659      0.32036406     -0.28200030]';
pnj = [     0.91406816     -0.27329227      0.29965109]';
Xpmi = [   -42.06713867     12.41052818     -3.54198885]';
Xpnj = [    43.98610687    -12.15480518      5.81524229]';
Xmi = [     0.00000000      0.00000000      0.00000000]';
Xnj = [     0.00000000      0.00000000      0.00000000]';
Ypmi = [    -0.31927133     -1.16039550     -0.24341007]';
Ypnj = [    -0.35792577     -1.24383342     -0.03865857]';
Ymi = [     0.00000000      0.00000000      0.00000000]';
Ynj = [     0.00000000      0.00000000      0.00000000]';
Omega = [     0.00000000      0.50000000      0.00000000]';
C0 =      0.05000000;
C1 =      0.00333333;
Cmi = [   134.09403992    -44.80068588     39.43578339;
    -44.80068588     23.49806213    -13.97009373;
    39.43578339    -13.97009373     19.92462349];
Cnj = [   136.82765198    -38.62886429     42.35458374;
    -38.62886429     19.17688751    -12.66336632;
    42.35458374    -12.66336632     21.51219368];
aimi = [  -134.08735657     43.12299347    -53.78025055]';
bimi = [     1.71464872     -2.58978915     -0.73731470]';
ainj = [   186.39645386    -40.86020660     61.63252258]';
binj = [    -0.46093917     -2.17384744     -0.39500773]';
ex = [     0.97398579      0.04641289      0.22180495]';
ey = [     0.00000000      0.97880071     -0.20481496]';
n = [    -0.22660889      0.19948687      0.95333803]';
umi_prev = [    16.67753601      1.43640900     -9.66169739]';
unj_prev = [    35.00207520     -1.48791504     16.58358192]';
wmi_prev = [    -0.34314048     -0.44916892     -0.25377041]';
wnj_prev = [    -1.37715912     -0.14151263     -0.15528378]';

%% calculations
aimi_diff = uxflmi+Ami*(fcmi+Xpmi-Xmi) - aimi;
bimi_diff = Omega+Cmi*(Dmi+Ypmi-Ymi+C1*tcmi+tbmi+C0*cross(pmi,Xpmi+Xmi))-bimi;

ainj_diff = uxflnj+Anj*(fcnj+Xpnj-Xnj) - ainj;
binj_diff = Omega+Cnj*(Dnj+Ypnj-Ynj+C1*tcnj+tbnj+C0*cross(pnj,Xpnj+Xnj)) - binj;
umi = uxflmi + Ami*(fmi+fcmi+Xpmi-Xmi);
wmi = Omega+Cmi*(Dmi+Ypmi-Ymi+C1*(tcmi+tmi)+tbmi+C0*cross(pmi,Xpmi+Xmi));

unj = uxflnj + Anj*(fnj+fcnj+Xpnj-Xnj);
wnj = Omega+Cnj*(Dnj+Ypnj-Ynj+C1*(tcnj+tnj)+tbnj+C0*cross(pnj,Xpnj+Xnj));

dU = umi + cross(wmi,Gij) - unj - cross(wnj, Gji);
dU_prev = umi_prev + cross(wmi_prev,Gij) - unj_prev - cross(wnj_prev, Gji);

dot(fmi,n)
dot(dU,ex)
dot(dU,ey)